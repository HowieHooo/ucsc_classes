<!DOCTYPE html>
<html>
  <head>
    <title>UCSC Courses and Events</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">


    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="stylesheet/materialize.min.css"  media="screen,projection"/>
    <link rel="stylesheet" type="text/css" href="stylesheet/style.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheet/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="stylesheet/bootstrap.min.css">

    <script src="script/location_data.js"></script>
    <script src="script/jquery-3.1.1.js"></script>

    <!--Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="script/materialize.min.js"></script>

  </head>

  <body>
    <div id="controls" class="box">
      <div>
      <!-- <div class="row">
        <div class="col-md-4">
          <button type="button" class="btn btn-default btn-lg" id="left-botton">Show events</button>
        </div>
        <div class="col-md-4">
          <button type="button" class="btn btn-default btn-lg" id="right-botton">Show classes</button>
        </div>
      </div> -->
      <select id="courses-variable" class="browser-default">
        <option value="HAHAHAHA" selected="selected">Select a day</option>
        <option value= "">All days </option>
        <option value="Mo">Monday</option>
        <option value="Tu">Tuesday</option>
        <option value="We">Wednesday</option>
        <option value="Th">Thursday</option>
        <option value="Fr">Friday</option>
        <option value="Sa">Saturday</option>
      </select>
      <select id="start-time" class="browser-default">
        <option value=0 selected="selected">Start after: Any</option>
        <option value=7>07:00AM</option>
        <option value=8>08:00AM</option>
        <option value=9>09:00AM</option>
        <option value=10>10:00AM</option>
        <option value=11>11:00AM</option>
        <option value=12>12:00PM</option>
        <option value=13>01:00PM</option>
        <option value=14>02:00PM</option>
        <option value=15>03:00PM</option>
        <option value=16>04:00PM</option>
        <option value=17>05:00PM</option>
        <option value=18>06:00PM</option>
        <option value=19>07:00PM</option>
        <option value=20>08:00PM</option>
      </select>
      <select id="end-time" class="browser-default">
        <option value=99 selected="selected">Ends by: Any</option>
        <option value=9>09:00AM</option>
        <option value=10>10:00AM</option>
        <option value=11>11:00AM</option>
        <option value=12>12:00AM</option>
        <option value=13>01:00PM</option>
        <option value=14>02:00PM</option>
        <option value=15>03:00PM</option>
        <option value=16>04:00PM</option>
        <option value=17>05:00PM</option>
        <option value=18>06:00PM</option>
        <option value=19>07:00PM</option>
        <option value=20>08:00PM</option>
        <option value=21>09:00PM</option>
        <option value=22>10:00PM</option>
      </select>


      <div class="nicebox">
          <div id="legend">
            <div id="census-min">min</div>
            <div class="color-key"><span id="data-caret">&#x25c6;</span></div>
            <div id="census-max">max</div>
          </div>
      </div>

        <div  id="time-reminder">
          <p>Spring quarter begins: 04/03/2017,  ends: 06/09/2017</p>
        </div>
    </div>
  </div>

     <!-- the content of sidenav -->
    <ul id="slide-out" class="side-nav">
     <li id="capacity">First line</li>
     <li>Second line</li>
     <li><div class="divider"></div></li>
     <li><a class="subheader">Subheader</a></li>
     <li><a class="waves-effect" href="#!">Third Link With Waves</a></li>
    </ul>
    <!-- don't show nav button -->
    <a href="#" data-activates="slide-out" class="button-collapse"></a>





    <div class="page-header">
          <h1><strong>What classes can we take in UCSC for our free time</strong></h1>
        </div>
        <div class="jumbotron">
          <div class="container">
            <div id="map"></div>
          </div>
        </div>

        <div class="footer">
          <div class="container">
            <div class="col-md-4">
              <h3>Credits</h3>
              <p>dasdasjdoisasaodjasiodjoajosdjosajdijaoisjdojasojdaosjdijasojdioajsoidjoaisjdoiaj,dasdhasodoaoisdjas
              dasdhaushduiasdhuiashdiuhiahiuhdiuadhuhaishdhuahsiduhaishudhaisudhiashiudhasuhdhiasuhduihasidhiahsudhiashdui
              dashudiahsudhaisduhiashudhaiudnasxozixjasudhiashdasndiasduashudihausdhiahsudhiuashdiuahusdhuhiu</p>
            </div>
          </div>
        </div>


    <script src="js/location_data.js"></script>>
    <script>

    // Initialize collapse button(show sideNav) by ww
    $(document).ready(function() {
      $(".button-collapse").sideNav({
        menuWidth: 300, // Default is 300
        edge: 'right', // Choose the horizontal origin
        closeOnClick: true, // Closes side-nav on <a> clicks, useful for Angular/Meteor
        draggable: true // Choose whether you can drag to open on touch screens
      });
    })

     var dayValue = document.getElementById("courses-variable").value;
     var startTime = document.getElementById("start-time").value;
     var endTime = document.getElementById("end-time").value;
     $.ajaxSetup({
        async: false
    });

     $.getJSON("data/events_data.json", function(json) {
     console.log(json);
     });

    //  function: showNavinfo by ww
     function showNavinfo() {
       $('.button-collapse').sideNav('show');
     }
    //Create the map
    function initMap() {
        var myLatlng = {lat: 36.993770, lng: -122.058924};

        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 15,
            center: myLatlng,
            maxZoom: 19,
            minZoom: 15,
            styles: [
              {
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#ebe3cd"
                  }
                ]
              },
              {
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#523735"
                  }
                ]
              },
              {
                "elementType": "labels.text.stroke",
                "stylers": [
                  {
                    "color": "#f5f1e6"
                  }
                ]
              },
              {
                "featureType": "administrative",
                "elementType": "geometry.stroke",
                "stylers": [
                  {
                    "color": "#c9b2a6"
                  }
                ]
              },
              {
                "featureType": "administrative.land_parcel",
                "elementType": "geometry.stroke",
                "stylers": [
                  {
                    "color": "#dcd2be"
                  }
                ]
              },
              {
                "featureType": "administrative.land_parcel",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#ae9e90"
                  }
                ]
              },
              {
                "featureType": "landscape.natural",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#dfd2ae"
                  }
                ]
              },
              {
                "featureType": "poi",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#dfd2ae"
                  }
                ]
              },
              {
                "featureType": "poi",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#93817c"
                  }
                ]
              },
              {
                "featureType": "poi.park",
                "elementType": "geometry.fill",
                "stylers": [
                  {
                    "color": "#a5b076"
                  }
                ]
              },
              {
                "featureType": "poi.park",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#447530"
                  }
                ]
              },
              {
                "featureType": "road",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#f5f1e6"
                  }
                ]
              },
              {
                "featureType": "road.arterial",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#fdfcf8"
                  }
                ]
              },
              {
                "featureType": "road.highway",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#f8c967"
                  }
                ]
              },
              {
                "featureType": "road.highway",
                "elementType": "geometry.stroke",
                "stylers": [
                  {
                    "color": "#e9bc62"
                  }
                ]
              },
              {
                "featureType": "road.highway.controlled_access",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#e98d58"
                  }
                ]
              },
              {
                "featureType": "road.highway.controlled_access",
                "elementType": "geometry.stroke",
                "stylers": [
                  {
                    "color": "#db8555"
                  }
                ]
              },
              {
                "featureType": "road.local",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#806b63"
                  }
                ]
              },
              {
                "featureType": "transit.line",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#dfd2ae"
                  }
                ]
              },
              {
                "featureType": "transit.line",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#8f7d77"
                  }
                ]
              },
              {
                "featureType": "transit.line",
                "elementType": "labels.text.stroke",
                "stylers": [
                  {
                    "color": "#ebe3cd"
                  }
                ]
              },
              {
                "featureType": "transit.station",
                "elementType": "geometry",
                "stylers": [
                  {
                    "color": "#dfd2ae"
                  }
                ]
              },
              {
                "featureType": "water",
                "elementType": "geometry.fill",
                "stylers": [
                  {
                    "color": "#b9d3c2"
                  }
                ]
              },
              {
                "featureType": "water",
                "elementType": "labels.text.fill",
                "stylers": [
                  {
                    "color": "#92998d"
                  }
                ]
              }
            ]
        });

    //If "courses-variable" changes, delete all circles and create new ones
       google.maps.event.addDomListener(document.getElementById("courses-variable"), 'change', function() {
       dayValue = document.getElementById("courses-variable").value;
       clearData();
       getData(dayValue,startTime,endTime);
       if (map.getZoom() === 15) {
           createCircle(70)
       }
       else if (map.getZoom() === 16) {
           createCircle(40)
       }
       else if (map.getZoom() === 17) {
           createCircle(25)
       }
       else{
           createCircle(70)
       }

     });

    //If "start-time" changes, delete all circles and create new ones
       google.maps.event.addDomListener(document.getElementById("start-time"), 'change', function() {
       startTime = document.getElementById("start-time").value;
       clearData();
       getData(dayValue,startTime,endTime);
       if (map.getZoom() === 15) {
           createCircle(70)
       }
       else if (map.getZoom() === 16) {
           createCircle(40)
       }
       else if (map.getZoom() === 17) {
           createCircle(25)
       }
       else{
           createCircle(70)
       }
     });

       google.maps.event.addDomListener(document.getElementById("end-time"), 'change', function() {
       endTime = document.getElementById("end-time").value;
       clearData();
       getData(dayValue,startTime,endTime);
       if (map.getZoom() === 15) {
           createCircle(70)
       }
       else if (map.getZoom() === 16) {
           createCircle(40)
       }
       else if (map.getZoom() === 17) {
           createCircle(25)
       }
       else{
           createCircle(70)
       }
     });

    // If zoom changes, delete all circles and create new ones
       google.maps.event.addListener(map, 'zoom_changed', function() {
           if(map.getZoom()<=17) {
               for (var i in window.allCircles) {
                   window.allCircles[i].setMap(null);
               }
               window.allCircles = [];
               if (map.getZoom() === 15) {
                   createCircle(70)
               }
               else if (map.getZoom() === 16) {
                   createCircle(40)
               }
               else if (map.getZoom() === 17) {
                   createCircle(25)
               }
               else{
                   createCircle(70)
               }
           }
    });



    // Keep track of the min and max of population in the selected time.
        var populationMin =5;
        var populationMax =5;
        for (var location in UCSC_locations) {
            if(UCSC_locations[location].population>0) {
                if (UCSC_locations[location].population < populationMin) {
                    populationMin = UCSC_locations[location].population;
                }
                if (UCSC_locations[location].population > populationMax) {
                    populationMax = UCSC_locations[location].population;
                }
            }
        }

        function createCircle(rr) {
            window.allCircles = [];
            for (var location in UCSC_locations) {
              var color = [];
              var opacity= 0.35;
              if(UCSC_locations[location].population>0) {
                 var pp = UCSC_locations[location].population;
                if (pp<=100){
                    color[0] = 113;
                    color[1] = 100;
                    color[2] = (85-30*pp/100)
                    opacity= 0.2;
                }
                else if (pp<=500){
                    color[0] = 70;
                    color[1] = 100;
                    color[2] = (70-30*pp/500);
                    opacity= 0.4;
                }
                else if (pp<=1000){
                    color[0] = 40 ;
                    color[1] = 100;
                    color[2] = (75-30*pp/1000);
                    opacity= 0.5;
                }
                else if(pp<=1800){
                    color[0] = 20;
                    color[1] = 100;
                    opacity= 0.6;
                    if(70-30*pp*1800<=50) {
                        color[2] = 70 - 30 * pp / 1800
                    }
                    else{color[2] = 50}
                }
                else if(pp<=3300){
                    color[0] = 5;
                    color[1] = 100;
                    opacity= 0.7;
                    if(70-30*pp*3300<=50) {
                        color[2] = 70 - 30 * pp / 3300
                    }
                    else{color[2] = 50}
                }

                else{
                    color[0] = 0;
                    color[1] = 100;
                    color[2] = 45;
                    opacity= 0.8;
                }

                color = 'hsl(' + color[0] + ',' + color[1] + '%,' + color[2] + '%)';
                var locationCircle = new google.maps.Circle({
                    strokeColor: '#FF300',
                    strokeOpacity: 0.7,
                    strokeWeight: 0.8,
                    fillColor: color,
                    fillOpacity: opacity,
                    map: map,
                    center: UCSC_locations[location].center,
                    radius: rr,
                    information: pp,
                    infowindow: new google.maps.InfoWindow({
                        content: JSON.stringify(UCSC_locations[location].classes),
                      //  content: JSON.stringify(UCSC_locations[location].Location),
                        // position: UCSC_locations[location].center
                      })
                });

                window.allCircles.push(locationCircle);

//                 google.maps.event.addListener(locationCircle, 'mouseover', function () {
//                     this.infowindow.open(map,this);
//                      });
// //                locationCircle.style.display="block";



//                 google.maps.event.addListener(locationCircle, 'mouseout', function(event) {
//                     this.infowindow.close(map,this);

//                 });

                //add click to show sideNav by ww
                locationCircle.addListener('click', function() {
                  showNavinfo();
                  // console.log(this.information);
                  // capacity is the id of the first li
                  $('#capacity').html(this.information);
                });
            }
        }

        }
    }

         getData = function(a,b,c){
          var temp = {};
         $.getJSON("data/data.json", function (classElement) {
             $.each(classElement, function (key, val) {
                 if (val.Day_And_Time.search(a) != -1 && val.starttime>=b && val.endtime<=c){
                     for (var location in UCSC_locations) {
                         if (val.Class_Location.search(UCSC_locations[location].Location) != -1){
                             UCSC_locations[location].population += val.Capacity;
                             temp[val.Subject+"   "+val.Class_Number + "   " + val.Class_name] = val.Day_And_Time;
                             UCSC_locations[location].classes= $.extend({}, temp)
                         }
                     }

                 }
             })
         });
//             console.log(UCSC_locations)

     };

      clearData= function(){
         for(var ii in UCSC_locations){
         UCSC_locations[ii].population = 0;
         UCSC_locations[ii].classes = {}
         }
         for(var i in window.allCircles) {
              window.allCircles[i].setMap(null);
         }
      };

     myFunction=function(){

        var a = document.getElementById("courses-variable");
        var b = document.getElementById("start-time");
        var c = document.getElementById("end-time");
        a.style.display = 'none';
        b.style.display = 'none';
        c.style.display = 'none';
        clearData()
     }

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAiRRPyv19TADLDHpnAdMEpO5ORBtM7iYo&callback=initMap">
    </script>
  </body>
</html>
